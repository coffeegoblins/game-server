/**
 * @license RequireJS text 2.0.9 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

define("Game/src/scheduler",[],function(){"use strict";function e(){this.isRunning=!1}function t(e){if(a.isRunning){var i=.001*(e-o);o=e,i>.05&&(i=.05);for(var n=c,r=c.next;r;){var l=r.eventData;null!=l.endTime&&(l.endTime-=i,l.endTime<0)?(l.completedMethod&&l.completedMethod.call(l.context,l),a.unschedule(l),n=r,r=r.next):(l.timeRemaining-=i,l.timeRemaining<0&&(l.method&&l.method.call(l.context,l,i),l.timeRemaining+=l.interval,l.timeRemaining<0&&(l.timeRemaining=0)),n=r,r=r.next)}s=window.requestAnimationFrame(t)}}for(var i=["ms","moz","webkit","o"],n=0;n<i.length&&!window.requestAnimationFrame;n++){var r=i[n];window.requestAnimationFrame=window[r+"RequestAnimationFrame"],window.cancelAnimationFrame=window[r+"CancelAnimationFrame"]||window[r+"CancelRequestAnimationFrame"]}e.prototype.clear=function(){c={}},e.prototype.start=function(){this.isRunning=!0,s=window.requestAnimationFrame(t)},e.prototype.stop=function(){this.isRunning=!1,window.cancelAnimationFrame(s)},e.prototype.schedule=function(e){null==e.interval&&(e.interval=0),null==e.priority&&(e.priority=this.priority.update),e.timeRemaining=e.interval;for(var t=c,i=c.next;i&&i.eventData.priority>e.priority;)t=i,i=i.next;t.next={eventData:e,next:i}},e.prototype.unschedule=function(e){for(var t=c,i=c.next;i;){if(i.eventData===e){t.next=i.next;break}t=i,i=i.next}},e.prototype.unscheduleById=function(e){for(var t=c,i=c.next;i;){if(i.eventData.id===e){t.next=i.next;break}t=i,i=i.next}},e.prototype.priority={update:1e3,render:100};var s,a=new e,o=0,c={};return a}),define("Game/src/utility",[],function(){"use strict";function e(){}return e.containsElement=function(e,t){for(var i=0;i<e.length;i++)if(e[i]===t)return!0;return!1},e.getElementByProperty=function(e,t,i){for(var n=0;n<e.length;n++)if(e[n][t]===i)return e[n]},e.getElementByProperties=function(e,t){for(var i=0;i<e.length;i++){var n=!0;for(var r in t)if(t.hasOwnProperty(r)&&e[i][r]!==t[r]){n=!1;break}if(n)return e[i]}},e.isTouchEnabled=function(){return"ontouchstart"in window||"onmsgesturechange"in window},e.merge=function(){for(var e=arguments[0],t=1;t<arguments.length;t++){var i=arguments[t];if(i)for(var n in i)e[n]=i[n]}return e},e.removeElement=function(e,t){var i=e.indexOf(t);i>=0&&e.splice(i,1)},e.removeElementByProperty=function(e,t,i){for(var n=0;n<e.length;n++){var r=e[n];if(r[t]===i)return e.splice(n,1),r}},e.removeElementByProperties=function(e,t){for(var i=0;i<e.length;i++){var n=!0;for(var r in t)if(t.hasOwnProperty(r)&&e[i][r]!==t[r]){n=!1;break}if(n)return e.splice(i,1)[0]}},e}),define("Game/src/eventManager",["./utility"],function(e){"use strict";function t(){var e=arguments[0];this.events||(this.events={}),this.events[e]||(this.events[e]=[]);var t,i;arguments.length>2?(t=arguments[1],i=arguments[2]):i=arguments[1],this.events[e].push({context:t,method:i})}function i(){if(this.events){var t=arguments[0];arguments.length>=3?e.removeElementByProperties(this.events[t],{context:arguments[1],method:arguments[2]}):2===arguments.length?e.removeElementByProperty(this.events[t],"method",arguments[1]):this.events[t]=void 0}}function n(){if(this.events){var e=this.events[arguments[0]];if(e&&e.length){Array.prototype.shift.call(arguments);for(var t=0;t<e.length;t++){var i=e[t];i.method.apply(i.context,arguments)}}}}function r(){}return r.register=function(e){e.on=t,e.off=i,e.trigger=n},r}),define("Game/src/inputHandler",["./eventManager","./scheduler"],function(e,t){"use strict";function i(){this.InputState={DOWN:0,UP:1,DRAGGING:2,FLICKING:3},this.mouseEvent=null,this.flickEvent=null,this.activeTouches={},this.handleInput=!0,this.registeredClickEvents={}}function n(e){d.handleInput&&1===e.which&&(d.mouseEvent=d.handlePressEvent(e)),e.preventDefault()}function r(e){d.handleInput&&d.mouseEvent&&d.handleMoveEvent(d.mouseEvent,e)}function s(){d.handleInput&&d.mouseEvent&&d.handleReleaseEvent(d.mouseEvent)}function a(e){if(d.handleInput&&e.changedTouches)for(var t=0;t<e.changedTouches.length;t++){var i=e.changedTouches[t];d.activeTouches[i.id]=d.handlePressEvent(i)}e.preventDefault()}function o(e){if(d.handleInput&&e.changedTouches)for(var t=0;t<e.changedTouches.length;t++){var i=e.changedTouches[t],n=d.activeTouches[i.id];n&&d.handleMoveEvent(n,i)}e.preventDefault()}function c(e){if(d.handleInput&&e.changedTouches)for(var t=0;t<e.changedTouches.length;t++){var i=e.changedTouches[t],n=d.activeTouches[i.id];n&&(d.handleReleaseEvent(n),delete d.activeTouches[i.id])}}function l(e){if(d.handleInput&&e.changedTouches)for(var t=0;t<e.changedTouches.length;t++)delete d.activeTouches[e.changedTouches.id]}function h(){d.activeTouches={}}i.getInstance=function(){return d},i.disableInput=function(){d.handleInput=!1},i.enableInput=function(){d.handleInput=!0},i.registerClickEvent=function(e,t,i){d.registeredClickEvents[e]={context:i,method:t}},i.unregisterClickEvent=function(e){d.registeredClickEvents[e]=void 0},e.register(i),i.prototype.handlePressEvent=function(e){t.unscheduleById("flick");var i={initialEvent:e,currentEvent:e,dragEvents:[],state:this.InputState.DOWN};return i},i.prototype.handleMoveEvent=function(e,t){switch(e.state){case this.InputState.DOWN:this.hasMovedEnough(e.initialEvent,t)&&(e.state=this.InputState.DRAGGING);break;case this.InputState.DRAGGING:var i=new Date;t.currentTime=i.getTime(),e.dragEvents.push(t);for(var n=0;n<e.dragEvents.length;++n){var r=t.currentTime-e.dragEvents[n].currentTime;if(100>r)break;e.dragEvents.splice(n,1),--n}this.sendDrag(e,t.pageX,t.pageY,e.currentEvent.pageX,e.currentEvent.pageY),e.currentEvent=t}},i.prototype.handleReleaseEvent=function(e){switch(e.state){case this.InputState.DOWN:this.sendClick(e.currentEvent||e.initialEvent);break;case this.InputState.DRAGGING:e.state=this.InputState.FLICKING,this.flickEvent=e;for(var i=0,n=0,r=0;r<this.flickEvent.dragEvents.length-1;++r)i+=this.flickEvent.dragEvents[r].pageX-this.flickEvent.dragEvents[r+1].pageX,n+=this.flickEvent.dragEvents[r].pageY-this.flickEvent.dragEvents[r+1].pageY;if(this.flickEvent.currentX=this.flickEvent.currentEvent.pageX,this.flickEvent.currentY=this.flickEvent.currentEvent.pageY,this.flickEvent.velocityX=i/(this.flickEvent.dragEvents.length-1),this.flickEvent.velocityY=n/(this.flickEvent.dragEvents.length-1),0!==this.flickEvent.velocityX&&0!==this.flickEvent.velocityY)return t.schedule({id:"flick",method:this.flick,context:this}),void 0}e.state=this.InputState.UP},i.prototype.flick=function(){var e=this.flickEvent.currentX+this.flickEvent.velocityX,i=this.flickEvent.currentY+this.flickEvent.velocityY;return this.flickEvent.velocityX*=.9,this.flickEvent.velocityY*=.9,0===Math.floor(Math.abs(this.flickEvent.velocityX))&&0===Math.floor(Math.abs(this.flickEvent.velocityY))?(t.unscheduleById("flick"),this.flickEvent=null,void 0):(this.sendDrag(this.flickEvent,this.flickEvent.currentX,this.flickEvent.currentY,e,i),this.flickEvent.currentX=e,this.flickEvent.currentY=i,void 0)},i.prototype.hasMovedEnough=function(e,t){return Math.abs(e.pageX-t.pageX)+Math.abs(e.pageY-t.pageY)>10},i.prototype.sendClick=function(e){var t=this.registeredClickEvents[e.target.id];if(t){var n=t.context||e.target;t.method.call(n,e)}else i.trigger("click",e)},i.prototype.sendDrag=function(e,t,n,r,s){var a=r-t,o=s-n;i.trigger("drag",e,a,o)};var u=function(e){e.preventDefault()};window.addEventListener("contextmenu",u,!1),window.addEventListener("MSHoldVisual",u,!1),window.addEventListener("selectstart",u,!1),window.addEventListener("mousedown",n,!1),window.addEventListener("mousemove",r,!1),window.addEventListener("mouseup",s,!1),window.addEventListener("blur",h,!1),("ontouchstart"in window||"onmsgesturechange"in window)&&(window.addEventListener("touchstart",a,!1),window.addEventListener("touchmove",o,!1),window.addEventListener("touchend",c,!1),window.addEventListener("touchcancel",l,!1),document.body.style.msTouchAction="none",document.body.className+=" touch");var d=new i;return i}),define("Game/src/turnManager",["./eventManager","./utility"],function(e,t){"use strict";function i(){this.unitList=[],this.activeUnit=null,this.endTurnPercentageCost=.75}return i.prototype.addUnit=function(e){this.unitList.push(e),e.on("death",this,this.removeUnit)},i.prototype.beginTurn=function(){this.activeUnit=this.unitList[0],this.trigger("beginTurn",this.activeUnit)},i.prototype.incrementAP=function(){if(this.unitList.length){var e=this.unitList[0],t=e.maxAP-e.ap;e.ap=e.maxAP;for(var i=1;i<this.unitList.length;++i){var n=this.unitList[i],r=n.maxAP-n.ap;n.ap+=Math.min(t,r)}}},i.prototype.endTurn=function(){var e=this.unitList.shift();e.ap*=this.endTurnPercentageCost,this.incrementAP();for(var t=this.unitList.length-1;t>=0;--t){var i=this.unitList[t],n=e.maxAP-e.ap,r=i.maxAP-i.ap;if(n>=r){this.unitList.splice(t+1,0,e);break}}this.activeUnit=null,this.trigger("endTurn",e,t+1)},i.prototype.removeUnit=function(e){t.removeElement(this.unitList,e)},e.register(i.prototype),new i}),define("Game/src/imageCache",[],function(){"use strict";function e(){this.width=this.data.width,this.height=this.data.height,this.isLoaded=!0,this.data.callback&&this.data.callback(this)}function t(){}var i={};return t.clear=function(){i={}},t.getImage=function(e){return i[e]},t.isLoading=function(){for(var e in i)if(i.hasOwnProperty(e)&&!i[e].isLoaded)return!0;return!1},t.loadImage=function(t,n,r){var s=i[t];return s||(s={callback:r,data:new Image,isLoaded:!1,path:n},s.data.onload=e.bind(s),s.data.src=n,i[t]=s),s},t.unloadImage=function(e){delete i[e]},t}),define("Game/src/spriteSheet",["Game/src/eventManager","./imageCache","./utility"],function(e,t,i){"use strict";function n(e,n,s){this.animations={},this.currentTile=0,i.merge(this,r,s),e&&n&&(this.image=t.loadImage(e,n))}var r={tileWidth:64,tileHeight:64};return n.prototype.defineAnimation=function(e,t){t.frames||(t.frames={}),t.name=e,this.animations[e]=t},n.prototype.getCurrentTileBounds=function(){return this.currentTileBounds||(this.currentTileBounds=this.getTileBounds(this.currentTile)),this.currentTileBounds},n.prototype.getTile=function(e,t){return this.image.isLoaded?e+t*Math.floor(this.image.width/this.tileWidth):void 0},n.prototype.getTileBounds=function(e){if(this.image.isLoaded){var t=Math.floor(this.image.width/this.tileWidth),i=e%t*this.tileWidth,n=Math.floor(e/t)*this.tileHeight;return{x:i,y:n,width:this.tileWidth,height:this.tileHeight}}},n.prototype.isLoaded=function(){return this.image&&this.image.isLoaded},n.prototype.playAnimation=function(e){this.currentAnimation=this.animations[e],this.currentAnimation.isComplete=!1,this.setCurrentTile(this.currentAnimation.start),this.animationTime=0},n.prototype.setCurrentTile=function(e){this.currentTile!==e&&(this.currentTile=e,this.currentTileBounds=null)},n.prototype.setImage=function(e){this.image=e},n.prototype.updateAnimation=function(e){if(this.currentAnimation||this.currentAnimation.isComplete){var t=0;this.animationTime+=e;for(var i=this.currentAnimation.start;i<=this.currentAnimation.end;i++)if(t+=null!=this.currentAnimation.frames[i]?this.currentAnimation.frames[i]:this.currentAnimation.speed,this.animationTime<t)return this.setCurrentTile(i),void 0;this.currentAnimation.isLooping?(this.animationTime-=t,this.setCurrentTile(this.currentAnimation.start)):(this.currentAnimation.isComplete=!0,this.trigger("animationComplete",this.currentAnimation))}},e.register(n.prototype),n}),define("Renderer/src/renderableMap",["Game/src/spriteSheet"],function(e){"use strict";function t(t){this.map=t,t.backgroundSpriteSheet&&(this.backgroundSpriteSheet=new e("background","Renderer/content/"+t.backgroundSpriteSheet+".png")),t.foregroundSpriteSheet&&(this.foregroundSpriteSheet=new e("foreground","Renderer/content/"+t.foregroundSpriteSheet+".png"))}function i(e,t,i,n,r,s,a,o){if(e&&t[i]){var c=e.getTileBounds(t[i]-1);if(c){var l=Math.floor(n*s-o.x),h=Math.floor(r*s-o.y);a.drawImage(e.image.data,c.x,c.y,c.width,c.height,l,h,s,s)}}}return t.prototype.getTileAtCoordinate=function(e,t,i){return this.map.getTile(Math.floor(e/i),Math.floor(t/i))},t.prototype.onClick=function(e,t,i,n){this.map.onClick(e,t,i,n)},t.prototype.render=function(e,t,n,r){this.visibleTileLeft=Math.max(0,Math.floor(r.x/n)),this.visibleTileTop=Math.max(0,Math.floor(r.y/n)),this.visibleTileRight=Math.min(this.map.width-1,Math.ceil((r.x+r.width)/n)),this.visibleTileBottom=Math.min(this.map.height-1,Math.ceil((r.y+r.height)/n));for(var s=this.visibleTileLeft;s<=this.visibleTileRight;s++)for(var a=this.visibleTileTop;a<=this.visibleTileBottom;a++){var o=this.map.getTile(s,a);i(this.backgroundSpriteSheet,o,"backgroundTile",s,a,n,e,r),i(this.foregroundSpriteSheet,o,"foregroundTile",s,a,n,e,r)}},t}),define("Renderer/src/renderableObject",[],function(){"use strict";function e(e){this.object=e}return e.prototype.isVisible=function(e,t,i,n){return this.object.tileX<=t&&this.object.tileY<=n&&this.object.tileX+this.object.sizeX>=e&&this.object.tileY+this.object.sizeY>=i},e.prototype.render=function(e,t,i,n){var r=i*this.object.sizeX,s=i*this.object.sizeY,a=Math.floor(.75*r),o=Math.floor(.75*s),c=1+(r-a)/2,l=1+(s-o)/2,h=this.object.tileX*i+c-n.x,u=this.object.tileY*i+l-n.y;e.beginPath(),e.fillStyle="#000",e.rect(h,u,a,o),e.fill()},e}),define("Renderer/src/renderableLadder",["Game/src/imageCache","Renderer/src/renderableObject"],function(e,t){"use strict";function i(i){t.call(this,i),this.image=e.loadImage("ladder","Renderer/content/ladder.png")}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.prototype.render=function(e,t,i,n){if(this.image.isLoaded){var r,s,a;switch(this.object.direction){case"left":a=-Math.PI/2,s=.125*i,r=.5*i;break;case"right":a=Math.PI/2,s=.875*i,r=.5*i;break;case"up":s=.5*i,r=.125*i;break;case"down":a=Math.PI,s=.5*i,r=.875*i}var o=this.object.tileX*i+s-n.x,c=this.object.tileY*i+r-n.y;e.save(),e.translate(o,c),e.rotate(a);var l=Math.floor(.5*i),h=-l/2;e.drawImage(this.image.data,h,h,l,l),e.restore()}},i}),define("Renderer/src/effects/transitionEffect",["Game/src/scheduler"],function(e){"use strict";function t(){}return t.prototype.transitionFloat=function(t,i,n,r,s,a,o,c){t&&e.unscheduleById(t);var l=parseFloat(i[n]);this.transitionEvent={id:t,source:i,styleName:n,suffix:r,currentValue:l,targetValue:s,deltaValue:s-l,totalTime:a,endTime:a,context:this,method:this.onValueUpdate,completedMethod:this.onValueUpdateCompleted,callbackContext:o,callbackMethod:c},e.schedule(this.transitionEvent)},t.prototype.onValueUpdate=function(e,t){e.currentValue+=e.deltaValue*t/e.totalTime;var i=e.currentValue;e.suffix&&(i+=e.suffix),e.source[e.styleName]=i},t.prototype.onValueUpdateCompleted=function(e){var t=e.targetValue;e.suffix&&(t+=e.suffix),e.source[e.styleName]=t,e.callbackMethod&&e.callbackMethod.call(e.callbackContext)},new t}),define("Renderer/src/renderableSoldier",["Game/src/imageCache","Game/src/spriteSheet","./effects/transitionEffect"],function(e,t,i){"use strict";function n(e){this.unit=e,this.style={},this.style.opacity=1,this.isSelected=!1,this.spriteSheet=r(this.unit.weapon.type),this.spriteSheet.playAnimation(this.unit.state),this.spriteSheet.on("animationComplete",this,this.onAnimationComplete),this.unit.on("stateChange",this.onStateChange.bind(this))}function r(e){var i=window.soldierAnimations[e],n=new t(i.spriteSheet,"Renderer/content/"+i.spriteSheet+".png",{tileWidth:i.tileWidth,tileHeight:i.tileHeight});for(var r in i.animations){var s=i.animations[r];s&&n.defineAnimation(r,s)}return n}var s={green:"#81f742",red:"#ff8787"};return n.prototype.isVisible=function(e,t,i,n){return this.unit.tileX<=t&&this.unit.tileY<=n&&this.unit.tileX>=e&&this.unit.tileY>=i},n.prototype.onStateChange=function(){this.spriteSheet.playAnimation(this.unit.state)},n.prototype.onAnimationComplete=function(e){this.unit.trigger("animationComplete",e.name),"death"===e.name&&i.transitionFloat(null,this.style,"opacity",null,.6,1)},n.prototype.render=function(e,t,i,n){if(this.spriteSheet.image.isLoaded){e.save();var r=i/2,a=this.unit.tileX*i-n.x+r,o=this.unit.tileY*i-n.y+r;e.translate(a,o),this.unit.direction&&e.rotate(this.unit.direction),this.spriteSheet.updateAnimation(t);var c=this.spriteSheet.getCurrentTileBounds();if(this.isSelected){e.beginPath(),e.arc(0,0,25,0,2*Math.PI);var l=s[this.unit.color];e.strokeStyle=l,e.fillStyle=l,e.globalAlpha=.1,e.fill(),e.globalAlpha=1,e.stroke()}e.globalAlpha=this.style.opacity,e.drawImage(this.spriteSheet.image.data,c.x,c.y,c.width,c.height,-r,-r,i,i),e.globalAlpha=1,e.restore()}},n}),define("Renderer/src/camera/camera",["Renderer/src/effects/transitionEffect"],function(e){"use strict";function t(){this.viewportRect={x:0,y:0,width:0,height:0},this.scale=64}return t.prototype.handleResize=function(e,t){var i=this.viewportRect.x+this.viewportRect.width/2,n=this.viewportRect.y+this.viewportRect.height/2;this.viewportRect.width=e,this.viewportRect.height=t,this.viewportRect.x=i-e/2,this.viewportRect.y=n-t/2,this.targetUnit&&this.moveToUnit(this.targetUnit,this.callbackContext,this.callback)},t.prototype.moveViewport=function(e,t){this.viewportRect.x+=e,this.viewportRect.y+=t},t.prototype.moveToUnit=function(t,i,n){var r=this.scale/2;this.targetUnit=t,this.targetX=t.tileX*this.scale+r-this.viewportRect.width/2,this.targetY=t.tileY*this.scale+r-this.viewportRect.height/2,this.callbackContext=i,this.callback=n,e.transitionFloat("moveToUnitX",this.viewportRect,"x",null,this.targetX,1,this,this.onMovedToUnit),e.transitionFloat("moveToUnitY",this.viewportRect,"y",null,this.targetY,1,this,this.onMovedToUnit)},t.prototype.onMovedToUnit=function(){this.viewportRect.x===this.targetX&&this.viewportRect.y===this.targetY&&(this.callback.call(this.callbackContext,this.targetUnit),this.targetUnit=null,this.targetX=null,this.targetY=null)},t}),define("Renderer/src/effects/blinkEffect",["Game/src/scheduler"],function(e){"use strict";function t(){}return t.prototype.stopBlink=function(t){e.unscheduleById(t.id+"opacity"),t.style.opacity=1},t.prototype.blink=function(t,i){this.stopBlink(t);var n=parseFloat(t.style.opacity);this.blinkEvent={id:t.id+"opacity",control:t,currentDegree:0,currentValue:n,deltaValue:i,context:this,method:this.onBlinkUpdate},e.schedule(this.blinkEvent)},t.prototype.onBlinkUpdate=function(e,t){e.currentDegree+=Math.PI*t/e.deltaValue,e.currentValue=Math.abs(Math.cos(e.currentDegree)),e.control.style.opacity=e.currentValue},new t}),define("Renderer/src/renderablePath",["Renderer/src/effects/blinkEffect"],function(e){"use strict";function t(t,i,n){this.id=t,this.nodes=i,this.maxDistance=0;for(var r=0;r<this.nodes.length;++r)this.nodes[r].distance>this.maxDistance&&(this.maxDistance=this.nodes[r].distance);this.style={},"attack"===t?(this.colorArray=[75,155,75],this.style.opacity=.4):n?(this.colorArray=[255,165,0],this.style.opacity=1,e.blink(this,1.5)):(this.colorArray=[255,165,0],this.style.opacity=.4)}return t.prototype.render=function(e,t,i,n){this.colorArray[3]=this.style.opacity,e.fillStyle="rgba("+this.colorArray.join()+")";for(var r=0;r<this.nodes.length;++r)e.beginPath(),e.rect(this.nodes[r].x*i+1-n.x,this.nodes[r].y*i+1-n.y,i-1,i-1),e.fill()},t}),define("Renderer/src/ui/renderableTurnQueue",["Renderer/src/effects/transitionEffect","Game/src/utility"],function(e,t){"use strict";function i(){this.unitList=[],this.element=document.createElement("div"),this.element.id="turnQueue",document.body.appendChild(this.element)}return i.prototype.addUnit=function(e){this.element.appendChild(this.createUnitElement(e)),e.on("death",this,this.removeUnit)},i.prototype.createUnitElement=function(e){var t=document.createElement("div");t.id=e.name,t.className="turn-queue-preview team-"+e.color;var i=document.createElement("div");return i.className="unit-preview unit-type-"+e.weapon.type,t.appendChild(i),t},i.prototype.getResizeStyleProperty=function(e){var i=t.isTouchEnabled()&&this.isLandscapeMode?"width":"height";if(!this.imageSize){var n=window.getComputedStyle(e);this.imageSize=parseFloat(n[i])}return i},i.prototype.handleResize=function(e,t){this.isLandscapeMode=e>t,this.imageSize=null},i.prototype.insertUnit=function(t,i){t.on("death",this,this.removeUnit);var n=this.createUnitElement(t);this.element.insertBefore(n,this.element.children[i]);var r=this.getResizeStyleProperty(n);n.style[r]=0,n.style.opacity=0,e.transitionFloat("TurnManagerInsertHeight",n.style,r,"px",this.imageSize,1,this,function(){e.transitionFloat("TurnManagerInsertOpacity",n.style,"opacity",null,1,.5,this,function(){n.style.opacity=1})})},i.prototype.onBeginTurn=function(){var i=t.isTouchEnabled()&&this.isLandscapeMode?"width":"height";this.element.firstChild.style.width=this.element.firstChild.width+"px",this.element.firstChild.style.height=this.element.firstChild.height+"px",e.transitionFloat("TurnManagerRemove",this.element.firstChild.style,i,"px",0,1,this,function(){this.element.removeChild(this.element.firstChild)})},i.prototype.onEndTurn=function(e,t){this.insertUnit(e,t)},i.prototype.removeUnit=function(t){var i=document.getElementById(t.name),n=this.getResizeStyleProperty(i);e.transitionFloat("TurnManagerInsertHeight",i.style,n,"px",0,1,this,function(){this.element.removeChild(i)})},new i}),define("renderer",["Game/src/inputHandler","Game/src/scheduler","Game/src/turnManager","Game/src/utility","Renderer/src/renderableMap","Renderer/src/renderableLadder","Renderer/src/renderableObject","Renderer/src/renderableSoldier","Renderer/src/camera/camera","Renderer/src/renderablePath","Renderer/src/effects/blinkEffect","Renderer/src/ui/renderableTurnQueue"],function(e,t,i,n,r,s,a,o,c,l,h,u){"use strict";function d(){this.canvas=null,this.context=null,this.camera=new c,this.renderableMap=null,this.renderables=[],this.renderablePaths=[],e.on("click",this,f),e.on("drag",this,m),i.on("beginTurn",this,this.onBeginTurn),i.on("endTurn",this,this.onEndTurn)}function p(){this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,this.camera.handleResize(this.canvas.width,this.canvas.height),u.handleResize(this.canvas.width,this.canvas.height)}function f(e){this.renderableMap.onClick(e,e.pageX+this.camera.viewportRect.x,e.pageY+this.camera.viewportRect.y,this.camera.scale)}function m(e,t,i){this.camera.moveViewport(t,i)}function v(e,t){if(this.context.clearRect(0,0,this.camera.viewportRect.width,this.camera.viewportRect.height),this.renderableMap){var i=this.renderableMap;i.render(this.context,t,this.camera.scale,this.camera.viewportRect);for(var n=0;n<this.renderablePaths.length;n++)this.renderablePaths[n].render(this.context,t,this.camera.scale,this.camera.viewportRect);for(n=0;n<this.renderables.length;n++){var r=this.renderables[n];r.isVisible(i.visibleTileLeft,i.visibleTileRight,i.visibleTileTop,i.visibleTileBottom)&&r.render(this.context,t,this.camera.scale,this.camera.viewportRect)}}}return d.prototype.addRenderableMap=function(e){this.renderableMap=new r(e)},d.prototype.clearRenderablePaths=function(){this.renderablePaths=[]},d.prototype.clearRenderablePathById=function(e){for(var t=0;t<this.renderablePaths.length;++t)if(this.renderablePaths[t].id===e)return this.renderablePaths.splice(t,1),void 0},d.prototype.addRenderableLadder=function(e){this.renderables.unshift(new s(e))},d.prototype.addRenderableObject=function(e){this.renderables.unshift(new a(e))},d.prototype.blinkUnit=function(e,t){for(var i=0;i<this.renderables.length;++i)if(e===this.renderables[i].unit){h.blink(this.renderables[i],t);break}},d.prototype.stopBlinkUnit=function(e){for(var t=0;t<this.renderables.length;++t)if(e===this.renderables[t].unit){h.stopBlink(this.renderables[t]);break}},d.prototype.addRenderablePath=function(e,t,i){this.renderablePaths.push(new l(e,t,i))},d.prototype.addRenderableSoldier=function(e){var t=new o(e);this.renderables.push(t),e.on("death",this,function(){n.removeElement(this.renderables,t);for(var e=0;e<this.renderables.length;e++){var i=this.renderables[e];if(!(i instanceof o)||i.unit.isAlive()){this.renderables.splice(e,0,t);break}}})},d.prototype.onEndTurn=function(e){for(var t=0;t<this.renderables.length;++t){var i=this.renderables[t];i.unit===e&&(i.isSelected=!1)}},d.prototype.onBeginTurn=function(e){for(var t=0;t<this.renderables.length;++t){var i=this.renderables[t];i instanceof o&&(i.isSelected=i.unit===e)}},d.prototype.initialize=function(e){this.canvas=e,this.context=e.getContext("2d"),p.call(this),window.addEventListener("resize",p.bind(this)),t.schedule({context:this,method:v,priority:t.priority.render})},new d}),define("Game/src/map",["./eventManager"],function(e){"use strict";function t(e,t){this.tiles=[],this.width=e,this.height=t;for(var i=0;t>i;i++)for(var n=0;e>n;n++)this.tiles.push({height:0})}return t.prototype.addObject=function(e,t,i){e.tileX=t,e.tileY=i;for(var n=t;n<t+e.sizeX;n++)for(var r=i;r<i+e.sizeY;r++){var s=this.getTile(n,r);s&&(s.content=e)}},t.prototype.addUnit=function(e,t,i){var n=this.getTile(t,i);e.tileX=t,e.tileY=i,n.unit=e,e.on("death",this,this.removeUnit)},t.prototype.canMoveToTile=function(e,t,i){var n=this.getTile(t,i);return!n||n.unit?!1:!n.content||n.content.isClimbable&&e.canClimbObjects?!0:!1},t.prototype.onClick=function(e,t,i,n){var r=Math.floor(t/n),s=Math.floor(i/n),a=this.getTile(r,s);a&&this.trigger("tileClick",a,r,s)},t.prototype.getTile=function(e,t){return 0>e||0>t||e>this.width-1||t>this.height-1?null:this.tiles[e+t*this.width]},t.prototype.removeObject=function(e){for(var t=e.tileX;t<e.tileX+e.sizeX;t++)for(var i=e.tileY;i<e.tileY+e.sizeY;i++){var n=this.getTile(t,i);n&&n.content===e&&(n.content=null)}},t.prototype.removeUnit=function(e){var t=this.getTile(e.tileX,e.tileY);t.unit=null},t.prototype.maxHeight=16,e.register(t.prototype),t}),define("Game/src/soldier",["./eventManager","Renderer/src/effects/transitionEffect","./utility"],function(e,t,i){"use strict";function n(e){i.merge(this,r,e)}var r={hp:100,maxHP:100,ap:42,maxAP:42,maxMoveableHeight:2,canClimbObjects:!0,direction:0,state:"idle",weapon:null,player:null};return n.prototype.damage=function(e){this.hp-=e,this.hp<=0&&(this.setState("death"),this.trigger("death",this))},n.prototype.isAlive=function(){return this.hp>0},n.prototype.setDirection=function(e,i){var n=-Math.atan2(e,i),r=n-this.direction;Math.abs(r)>Math.PI&&(this.direction<0?this.direction+=2*Math.PI:this.direction-=2*Math.PI),t.transitionFloat(this.name+" turn",this,"direction",null,n,.1)},n.prototype.setState=function(e){this.state=e,this.trigger("stateChange")},e.register(n.prototype),n}),define("Game/src/worldObject",["./utility"],function(e){"use strict";function t(t){e.merge(this,i,t)}var i={sizeX:1,sizeY:1};return t}),define("Game/src/ladder",["./utility","./worldObject"],function(e,t){"use strict";function i(i){i=e.merge({},n,i),t.call(this,i)}var n={direction:"top",isClimbable:!0};return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i}),define("text",["module"],function(e){"use strict";var t,i,n,r,s,a=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],o=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,c=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,l="undefined"!=typeof location&&location.href,h=l&&location.protocol&&location.protocol.replace(/\:/,""),u=l&&location.hostname,d=l&&(location.port||void 0),p={},f=e.config&&e.config()||{};return t={version:"2.0.9",strip:function(e){if(e){e=e.replace(o,"");var t=e.match(c);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:f.createXhr||function(){var e,t,i;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){i=a[t];try{e=new ActiveXObject(i)}catch(n){}if(e){a=[i];break}}return e},parseName:function(e){var t,i,n,r=!1,s=e.indexOf("."),a=0===e.indexOf("./")||0===e.indexOf("../");return-1!==s&&(!a||s>1)?(t=e.substring(0,s),i=e.substring(s+1,e.length)):t=e,n=i||t,s=n.indexOf("!"),-1!==s&&(r="strip"===n.substring(s+1),n=n.substring(0,s),i?i=n:t=n),{moduleName:t,ext:i,strip:r}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,i,n,r){var s,a,o,c=t.xdRegExp.exec(e);return c?(s=c[2],a=c[3],a=a.split(":"),o=a[1],a=a[0],!(s&&s!==i||a&&a.toLowerCase()!==n.toLowerCase()||(o||a)&&o!==r)):!0},finishLoad:function(e,i,n,r){n=i?t.strip(n):n,f.isBuild&&(p[e]=n),r(n)},load:function(e,i,n,r){if(r.isBuild&&!r.inlineText)return n(),void 0;f.isBuild=r.isBuild;var s=t.parseName(e),a=s.moduleName+(s.ext?"."+s.ext:""),o=i.toUrl(a),c=f.useXhr||t.useXhr;!l||c(o,h,u,d)?t.get(o,function(i){t.finishLoad(e,s.strip,i,n)},function(e){n.error&&n.error(e)}):i([a],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,n)})},write:function(e,i,n){if(p.hasOwnProperty(i)){var r=t.jsEscape(p[i]);n.asModule(e+"!"+i,"define(function () { return '"+r+"';});\n")}},writeFile:function(e,i,n,r,s){var a=t.parseName(i),o=a.ext?"."+a.ext:"",c=a.moduleName+o,l=n.toUrl(a.moduleName+o)+".js";t.load(c,n,function(){var i=function(e){return r(l,e)};i.asModule=function(e,t){return r.asModule(e,l,t)},t.write(e,c,i,s)},s)}},"node"===f.env||!f.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(i=require.nodeRequire("fs"),t.get=function(e,t,n){try{var r=i.readFileSync(e,"utf8");0===r.indexOf("ï»¿")&&(r=r.substring(1)),t(r)}catch(s){n(s)}}):"xhr"===f.env||!f.env&&t.createXhr()?t.get=function(e,i,n,r){var s,a=t.createXhr();if(a.open("GET",e,!0),r)for(s in r)r.hasOwnProperty(s)&&a.setRequestHeader(s.toLowerCase(),r[s]);f.onXhr&&f.onXhr(a,e),a.onreadystatechange=function(){var t,r;4===a.readyState&&(t=a.status,t>399&&600>t?(r=new Error(e+" HTTP status: "+t),r.xhr=a,n(r)):i(a.responseText),f.onXhrComplete&&f.onXhrComplete(a,e))},a.send(null)}:"rhino"===f.env||!f.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var i,n,r="utf-8",s=new java.io.File(e),a=java.lang.System.getProperty("line.separator"),o=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),r)),c="";try{for(i=new java.lang.StringBuffer,n=o.readLine(),n&&n.length()&&65279===n.charAt(0)&&(n=n.substring(1)),null!==n&&i.append(n);null!==(n=o.readLine());)i.append(a),i.append(n);c=String(i.toString())}finally{o.close()}t(c)}:("xpconnect"===f.env||!f.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(n=Components.classes,r=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in n,t.get=function(e,t){var i,a,o,c={};s&&(e=e.replace(/\//g,"\\")),o=new FileUtils.File(e);try{i=n["@mozilla.org/network/file-input-stream;1"].createInstance(r.nsIFileInputStream),i.init(o,1,0,!1),a=n["@mozilla.org/intl/converter-input-stream;1"].createInstance(r.nsIConverterInputStream),a.init(i,"utf-8",i.available(),r.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),a.readString(i.available(),c),a.close(),i.close(),t(c.value)}catch(l){throw new Error((o&&o.path||"")+": "+l)}}),t}),define("text!Game/content/weapons.json",[],function(){return'{\r\n    "Flimsy Short Bow": {\r\n        "damage": 15,\r\n        "range": 50,\r\n        "cost": 50,\r\n        "block": 0,\r\n		"type" : "archer"\r\n    },\r\n    "Short Bow": {\r\n        "damage": 25,\r\n        "range": 60,\r\n        "cost": 30,\r\n        "block": 0,\r\n		"type" : "archer"\r\n    },\r\n    "Superior Short Bow": {\r\n        "damage": 35,\r\n        "range": 70,\r\n        "cost": 50,\r\n        "block": 0,\r\n		"type" : "archer"\r\n    },\r\n    "Flimsy Long Bow": {\r\n        "damage": 15,\r\n        "range": 80,\r\n        "cost": 75,\r\n        "block": 0,\r\n		"type" : "archer"\r\n    },\r\n    "Long Bow": {\r\n        "damage": 25,\r\n        "range": 90,\r\n        "cost": 75,\r\n        "block": 0,\r\n		"type" : "archer"\r\n    },\r\n    "Superior Long Bow": {\r\n        "damage": 35,\r\n        "range": 100,\r\n        "cost": 75,\r\n        "block": 0,\r\n		"type" : "archer"\r\n    },\r\n    "Rusty Bronze Sword and Shield": {\r\n        "damage": 15,\r\n        "range": 14,\r\n        "cost": 50,\r\n        "block": 15,\r\n		"type" : "swordAndShield"\r\n    },\r\n    "Bronze Sword and Shield": {\r\n        "damage": 20,\r\n        "range": 14,\r\n        "cost": 50,\r\n        "block": 20,\r\n		"type" : "swordAndShield"\r\n    },\r\n    "Reinforced Bronze Sword and Shield": {\r\n        "damage": 25,\r\n        "range": 14,\r\n        "cost": 50,\r\n        "block": 25,\r\n		"type" : "swordAndShield"\r\n    },\r\n    "Rusty Steel Sword and Shield": {\r\n        "damage": 25,\r\n        "range": 14,\r\n        "cost": 60,\r\n        "block": 30,\r\n		"type" : "swordAndShield"\r\n    },\r\n    "Steel Sword and Shield": {\r\n        "damage": 20,\r\n        "range": 14,\r\n        "cost": 60,\r\n        "block": 35,\r\n		"type" : "swordAndShield"\r\n    },\r\n    "Reinforced Steel Sword and Shield": {\r\n        "damage": 35,\r\n        "range": 14,\r\n        "cost": 60,\r\n        "block": 40,\r\n		"type" : "swordAndShield"\r\n    },\r\n    "Chipped Twin Bronze Swords": {\r\n        "damage": 20,\r\n        "range": 14,\r\n        "cost": 50,\r\n        "block": 5,\r\n		"type" : "dualWield"\r\n    },\r\n    "Twin Bronze Swords": {\r\n        "damage": 30,\r\n        "range": 14,\r\n        "cost": 50,\r\n        "block": 5,\r\n		"type" : "dualWield"\r\n    },\r\n    "Sharpened Twin Bronze Swords": {\r\n        "damage": 40,\r\n        "range": 14,\r\n        "cost": 50,\r\n        "block": 5,\r\n		"type" : "dualWield"\r\n    },\r\n    "Chipped Twin Steel Swords": {\r\n        "damage": 50,\r\n        "range": 14,\r\n        "cost": 50,\r\n        "block": 5,\r\n		"type" : "dualWield"\r\n    },\r\n    "Twin Steel Swords": {\r\n        "damage": 60,\r\n        "range": 14,\r\n        "cost": 50,\r\n        "block": 5,\r\n		"type" : "dualWield"\r\n    },\r\n    "Sharpened Twin Steel Swords": {\r\n        "damage": 75,\r\n        "range": 14,\r\n        "cost": 50,\r\n        "block": 5,\r\n		"type" : "dualWield"\r\n    },\r\n    "Broken Iron Longsword": {\r\n        "damage": 40,\r\n        "range": 14,\r\n        "cost": 75,\r\n        "block": 5,\r\n		"type" : "twoHanded"\r\n    },\r\n    "Iron Longsword": {\r\n        "damage": 50,\r\n        "range": 14,\r\n        "cost": 75,\r\n        "block": 5,\r\n		"type" : "twoHanded"\r\n    },\r\n    "Great Iron Longsword": {\r\n        "damage": 60,\r\n        "range": 14,\r\n        "cost": 75,\r\n        "block": 5,\r\n		"type" : "twoHanded"\r\n    },\r\n    "Broken Steel Longsword": {\r\n        "damage": 70,\r\n        "range": 14,\r\n        "cost": 75,\r\n        "block": 5,\r\n		"type" : "twoHanded"\r\n    },\r\n    "Steel Longsword": {\r\n        "damage": 80,\r\n        "range": 14,\r\n        "cost": 75,\r\n        "block": 5,\r\n		"type" : "twoHanded"\r\n    },\r\n    "Great Steel Longsword": {\r\n        "damage": 90,\r\n        "range": 14,\r\n        "cost": 75,\r\n        "block": 5,\r\n		"type" : "twoHanded"\r\n    }\r\n}'
}),define("text!Game/content/level1.json",[],function(){return'{"layers":[{"name":"Objects","type":"objectLayer","objects":[{"typeName":"soldier","name":"Soldier1","weapon":"Short Bow","player":"Player1","color":"green","x":4,"y":1},{"typeName":"soldier","name":"Soldier4","weapon":"Twin Bronze Swords","player":"Player2","color":"red","x":10,"y":1},{"typeName":"soldier","name":"Soldier2","weapon":"Long Bow","player":"Player1","color":"green","x":1,"y":4},{"typeName":"soldier","name":"soldier5","weapon":"Great Iron Longsword","player":"Player2","color":"red","x":8,"y":6},{"typeName":"soldier","name":"Soldier6","weapon":"Great Iron Longsword","player":"Player2","color":"red","x":12,"y":4},{"typeName":"soldier","name":"Soldier3","weapon":"Bronze Sword and Shield","player":"Player1","color":"green","x":2,"y":8}]},{"name":"Foreground","type":"tileLayer","properties":{"rect":{"x":0,"y":0,"width":32,"height":32},"tileSize":64},"spriteSheet":"terrain","tiles":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,31,0,0,0,26,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,31,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,25,0,0,0,0,0,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,27,0,0,0,27,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,27,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,29,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{"name":"Background","type":"tileLayer","properties":{"rect":{"x":0,"y":0,"width":32,"height":32},"tileSize":64},"spriteSheet":"terrain","tiles":[2,4,2,5,13,13,13,13,7,4,1,4,1,1,1,1,1,4,21,13,13,13,13,13,13,13,13,13,13,13,13,13,4,3,5,13,16,13,13,13,8,2,4,2,1,1,1,22,22,21,13,13,13,13,13,13,13,13,13,13,13,13,13,13,2,1,12,13,13,13,14,13,8,1,4,4,1,4,5,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,4,5,13,13,13,13,13,13,13,7,2,2,1,4,12,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,21,13,14,13,17,18,18,19,16,13,7,1,1,5,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,12,13,13,13,24,2,1,2,19,13,13,7,22,12,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,12,13,15,13,23,22,22,22,21,13,14,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,11,10,10,10,10,10,10,10,10,10,10,17,18,19,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,1,4,1,1,1,1,1,1,1,4,1,4,1,4,12,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,4,2,4,4,4,4,4,4,4,2,4,2,4,21,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,1,1,4,4,5,6,6,6,6,6,6,6,6,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,4,4,22,21,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,2,21,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,21,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13]},{"name":"Heights","type":"tileLayer","properties":{"rect":{"x":0,"y":0,"width":32,"height":32},"tileSize":64},"spriteSheet":"heights","tiles":[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]}]}'}),define("jsonLoader",["text!Game/content/weapons.json","text!Game/content/level1.json"],function(e,t){"use strict";return function(i,n){switch(i){case"level1":n(JSON.parse(t));break;case"weapons":n(JSON.parse(e))}}}),define("Game/src/levelLoader",["renderer","Game/src/map","Game/src/soldier","Game/src/worldObject","Game/src/ladder","Game/src/turnManager","Renderer/src/ui/renderableTurnQueue","jsonLoader"],function(e,t,i,n,r,s,a,o){"use strict";return{loadLevel:function(e,t,i){var n=this;this.weaponData=t,o(e,function(e){n.onLevelLoaded(e,i)})},onLevelLoaded:function(i,n){for(var r,o=0,c=0,l=0;l<i.layers.length;l++)if(r=i.layers[l],"tileLayer"===r.type){var h=r.properties.rect;o=Math.max(o,h.x+h.width),c=Math.max(c,h.y+h.height)}for(this.map=new t(o,c),l=0;l<i.layers.length;l++)if(r=i.layers[l],"objectLayer"===r.type)this.loadObjects(r);else switch(r.name){case"Foreground":this.map.foregroundSpriteSheet=r.spriteSheet,this.loadTiles(r,"foregroundTile");break;case"Background":this.map.backgroundSpriteSheet=r.spriteSheet,this.loadTiles(r,"backgroundTile");break;case"Heights":this.loadTiles(r,"height")}e.addRenderableMap(this.map),s.on("beginTurn",a,a.onBeginTurn),s.on("endTurn",a,a.onEndTurn),this.player=s.unitList[0].player,n&&n(this.map,this.player)},loadObjects:function(t){for(var o=0;o<t.objects.length;o++){var c=t.objects[o];switch(c.typeName){case"ladder":var l=new r(c);this.map.addObject(l,c.x,c.y),e.addRenderableLadder(l);break;case"object":var h=new n(c);this.map.addObject(h,c.x,c.y),e.addRenderableObject(h);break;case"soldier":var u=new i(c),d=u.weapon;u.weapon=this.weaponData[u.weapon],u.weapon.name=d,this.map.addUnit(u,c.x,c.y),s.addUnit(u),a.addUnit(u),e.addRenderableSoldier(u)}}},loadTiles:function(e,t){for(var i=0;i<e.tiles.length;i++){var n=e.properties.rect,r=n.x+i%n.width,s=n.y+Math.floor(i/n.width),a=this.map.getTile(r,s);a&&(a[t]=e.tiles[i])}}}}),define("Renderer/src/ui/actionBarView",["Game/src/inputHandler","Renderer/src/effects/transitionEffect","Game/src/utility"],function(e,t,i){"use strict";function n(){this.actionsList=[],this.element=document.createElement("div"),this.element.id="actionBarView",this.element.style.display="none",this.containerElement=document.createElement("div"),this.containerElement.className="action-container",this.element.appendChild(this.containerElement),document.body.appendChild(this.element)}return n.prototype.addActions=function(t){for(var n=document.createDocumentFragment(),r=0;r<t.length;r++){var s=t[r];if(!i.getElementByProperty(this.actionsList,"id",s.id)){var a=document.createElement("div");a.title=s.id,a.id=s.id,a.className="action action-"+s.id,s.element=a,this.actionsList.push(s),e.registerClickEvent(s.id,s.method,s.context),n.appendChild(a)}}this.containerElement.appendChild(n)},n.prototype.removeActionById=function(t){var n=i.removeElementByProperty(this.actionsList,"id",t);n&&(e.unregisterClickEvent(t),n.element&&this.containerElement.removeChild(n.element))},n.prototype.removeAllActions=function(){for(this.actionsList.length=0;this.containerElement.firstChild;)e.unregisterClickEvent(this.containerElement.firstChild.id),this.containerElement.removeChild(this.containerElement.firstChild)},n.prototype.hideActions=function(){var e=this.element;t.transitionFloat("actionBarViewOpacity",this.element.style,"opacity",null,0,.5,null,function(){e.style.display="none"})},n.prototype.showActions=function(){this.element.style.display="",t.transitionFloat("actionBarViewOpacity",this.element.style,"opacity",null,1,.5)},new n}),define("text!Renderer/content/activeUnitView.html",[],function(){return"<div class=\"active-unit-preview\"></div>\r\n<div id='activeUnitHP' class='outerBar'>\r\n    <div class='innerBarPreview'></div>\r\n    <div class='innerBar'></div>\r\n</div>\r\n<div id='activeUnitAP' class='outerBar'>\r\n    <div class='innerBarPreview'></div>\r\n    <div class='innerBar'></div>\r\n</div>"}),define("Renderer/src/ui/renderableProgressBar",["Renderer/src/effects/blinkEffect","Renderer/src/effects/transitionEffect"],function(e,t){"use strict";function i(e){this.element=e,this.foregroundElement=e.querySelector(".innerBar"),this.foregroundElement.style.width="100%",this.previewElement=e.querySelector(".innerBarPreview")}return i.prototype.blinkPortion=function(t){this.previewElement.style.width=this.foregroundElement.style.width,this.foregroundElement.style.width=100*((this.progress-t)/this.maxProgress)+"%",e.blink(this.previewElement,1)},i.prototype.setProgress=function(e,t,i){this.progress=t,this.maxProgress=i;var n=100*(t/i);this.foregroundElement.style.width=n+"%"},i.prototype.transitionProgress=function(e,i,n,r){this.progress=i,this.maxProgress=n;var s=100*(i/n);t.transitionFloat(e,this.foregroundElement.style,"width","%",s,r,this,function(){this.foregroundElement.style.width=s+"%"})},i.prototype.stopBlink=function(){this.foregroundElement.style.width=100*(this.progress/this.maxProgress)+"%",this.previewElement.style.width="0%",e.stopBlink(this.previewElement)},i}),define("Renderer/src/ui/activeUnitView",["text!Renderer/content/activeUnitView.html","Renderer/src/ui/renderableProgressBar","Renderer/src/effects/transitionEffect"],function(e,t,i){"use strict";function n(){this.element=document.createElement("div"),this.element.id="activeUnitView",this.element.innerHTML=e,this.element.style.opacity=0,this.previewImage=this.element.querySelector(".active-unit-preview"),this.hpBar=new t(this.element.querySelector("#activeUnitHP")),this.apBar=new t(this.element.querySelector("#activeUnitAP")),document.body.appendChild(this.element)}return n.prototype.onBeginTurn=function(e){this.hpBar.transitionProgress("hpBar",e.hp,e.maxHP,1),this.apBar.transitionProgress("apBar",e.ap,e.maxAP,1),this.element.className="team-"+e.color,this.previewImage.className="active-unit-preview unit-type-"+e.weapon.type,i.transitionFloat("activeUnitViewOpacity",this.element.style,"opacity",null,1,.5,this,function(){this.element.style.opacity=1})},n.prototype.onEndTurn=function(){this.apBar.stopBlink(),i.transitionFloat("activeUnitViewOpacity",this.element.style,"opacity",null,0,.5,this,function(){this.element.style.opacity=0})},n.prototype.previewAP=function(e){0===e?this.apBar.stopBlink():this.apBar.blinkPortion(e)},n.prototype.setAP=function(e,t){this.apBar.setProgress("apBar",e,t)},n}),define("Game/src/pathManager",["./utility"],function(e){"use strict";function t(){}var i=[[-1,-1],[-1,1],[1,1],[1,-1],[0,1],[0,-1],[1,0],[-1,0]];return t.defaultMoveCost=10,t.diagonalMoveCost=14,t.canMoveToDiagonal=function(e,i,n,r,s){return t.canMoveToTile(e,i,n,r,s)&&t.canMoveToTile(e,i,n,0,s)&&t.canMoveToTile(e,i,0,r,s)},t.canMoveToTile=function(e,t,i,n,r){var s=e.getTile(t.x+i,t.y+n);if(!s||null!=s.unit&&!r.ignoreUnits)return!1;var a,o;return!r.canClimbObjects||0!==i&&0!==n||(a=t.tile.content&&t.tile.content.isClimbable,o=s.content&&s.content.isClimbable),s.content&&!o?!1:Math.abs(t.tile.height-s.height)>r.maxClimbableHeight&&!a&&!o?!1:!0},t.findClosestNeighbor=function(e){for(var t=0,i=0;i<e.neighbors.length;++i)e.neighbors[i].distance<e.neighbors[t].distance&&(t=i);return e.neighbors[t]},t.getClosestTile=function(e){for(var t=0,i=0;i<e.length;++i)e[i].distance<e[t].distance&&(t=i);return e.splice(t,1)[0]},t.calculateAvailableTiles=function(n,r){for(var s={distance:0,x:r.x,y:r.y,tile:n.getTile(r.x,r.y),neighbors:[]},a=[],o=[s];;){if(s=t.getClosestTile(o),null==s||!isFinite(s.distance)||s.distance>r.maxDistance)break;a.push(s);for(var c=0;c<i.length;c++){var l=i[c][0],h=i[c][1],u=s.x+l,d=s.y+h,p=n.getTile(u,d);if(p&&!e.getElementByProperties(a,{x:u,y:d})){var f=0!==l&&0!==h;if(f){if(!t.canMoveToDiagonal(n,s,l,h,r))continue}else if(!t.canMoveToTile(n,s,l,h,r))continue;var m=e.getElementByProperties(o,{x:u,y:d});m||(m={distance:1/0,x:u,y:d,tile:p,neighbors:[s]},o.push(m));var v=p.height-s.tile.height,g=s.distance+(f?t.diagonalMoveCost:t.defaultMoveCost);Math.abs(v)<=r.maxClimbableHeight&&(g+=v),g<m.distance&&(m.distance=g),s.neighbors.push(m)}}}return a},t.calculatePathFromNodes=function(i,n,r,s,a){var o=e.getElementByProperties(i,{x:s,y:a});if(o){for(var c=[];o.x!==n||o.y!==r;)c.unshift(o),o=t.findClosestNeighbor(o);return c}},t}),define("Game/src/attackManager",["renderer","./inputHandler","./pathManager","Renderer/src/ui/actionBarView","./utility"],function(e,t,i,n,r){"use strict";function s(e,t){this.actionBarSnapshot=[],this.availableAttackTiles=[],this.currentMap=e,this.activeUnitView=t}return s.prototype.onBeginTurn=function(e){this.activeUnit=e},s.prototype.onAttackAction=function(){this.actionBarSnapshot.push(n.actionsList.slice(0)),n.removeAllActions();var e=[];switch(this.activeUnit.weapon.type){case"archer":e.push({id:"shortShot",method:this.onShortShotAction,context:this}),e.push({id:"longShot",method:this.onLongShotAction,context:this});break;case"swordAndShield":e.push({id:"strike",method:this.onStrikeAction,context:this}),e.push({id:"shield",method:this.onShieldBash,context:this});break;case"twoHanded":e.push({id:"strike",method:this.onStrikeAction,context:this}),e.push({id:"sweep",method:this.onSweepAction,context:this});break;case"dualWield":e.push({id:"strike",method:this.onStrikeAction,context:this})}e.push({id:"cancel",method:this.onAttackActionCancelled,context:this}),n.addActions(e)},s.prototype.onAttackActionCancelled=function(){e.clearRenderablePaths(),this.revertActionBar(),this.selectedNode=null,this.currentMap.off("tileClick",this,this.onTileSelected)},s.prototype.onShieldBash=function(){this.onActionSelected({maxDistance:Math.min(this.activeUnit.weapon.range,i.defaultMoveCost)})},s.prototype.onStrikeAction=function(){this.onActionSelected({maxDistance:Math.min(this.activeUnit.weapon.range,i.defaultMoveCost)})},s.prototype.onSweepAction=function(){this.onActionSelected({maxDistance:Math.min(this.activeUnit.weapon.range,i.diagonalMoveCost)}),this.crossNodes=!0},s.prototype.onShortShotAction=function(){this.onActionSelected({maxDistance:this.activeUnit.weapon.range/2})},s.prototype.onLongShotAction=function(){this.onActionSelected({maxDistance:this.activeUnit.weapon.range})},s.prototype.onActionSelected=function(t){e.clearRenderablePaths(),this.actionBarSnapshot.push(n.actionsList.slice(0)),n.removeAllActions(),n.addActions([{id:"cancel",method:this.onAttackActionCancelled,context:this}]);var s=r.merge({x:this.activeUnit.tileX,y:this.activeUnit.tileY,maxClimbableHeight:this.activeUnit.maxMoveableHeight,ignoreUnits:!0},t);this.availableAttackTiles=i.calculateAvailableTiles(this.currentMap,s),e.addRenderablePath("attack",this.availableAttackTiles,!1),this.currentMap.on("tileClick",this,this.onTileSelected)},s.prototype.onTileSelected=function(t){if(t.unit===this.activeUnit)return this.onAttackActionCancelled(),void 0;if(this.selectedNode=r.getElementByProperty(this.availableAttackTiles,"tile",t),this.selectedNode){if(e.clearRenderablePathById("selectedAttackNodes"),this.selectedNodes=[],this.selectedNodes.push(this.selectedNode),n.removeActionById("Attack"),this.crossNodes){var i=this.calculateCrossNodes(this.selectedNode,this.availableAttackTiles);i.push(this.selectedNode),this.selectedNodes=i}e.addRenderablePath("selectedAttackNodes",this.selectedNodes,!0);for(var s=0;s<this.selectedNodes.length;++s)if(null!=this.selectedNodes[s].tile.unit){n.removeAllActions(),n.addActions([{id:"attack",method:this.onAttackConfirmed,context:this},{id:"cancel",method:this.onAttackActionCancelled,context:this}]),this.activeUnitView.previewAP(this.activeUnit.weapon.cost);break}}},s.prototype.calculateCrossNodes=function(e,t){for(var i=[],n=0;n<t.length;++n){var r=t[n];(r.x===e.x&&(r.y===e.y-1||r.y===e.y+1)||r.y===e.y&&(r.x===e.x-1||r.x===e.x+1))&&r.tile.unit!==this.activeUnit&&i.push(r)}return i},s.prototype.onAttackConfirmed=function(){var i=this.selectedNode.x-this.activeUnit.tileX,n=this.selectedNode.y-this.activeUnit.tileY;this.activeUnit.setDirection(i,n),this.activeUnit.setState("attack"),e.clearRenderablePaths(),t.disableInput(),this.activeUnit.on("animationComplete",this,function r(){for(var e=0;e<this.selectedNodes.length;++e){var i=this.selectedNodes[e];i.tile.unit&&i.tile.unit.damage(this.activeUnit.weapon.damage)}for(this.activeUnit.ap-=this.activeUnit.weapon.cost,this.activeUnit.setState("idle"),this.activeUnitView.previewAP(0),this.activeUnitView.setAP(this.activeUnit.ap,this.activeUnit.maxAP),this.selectedNode=null,this.selectedNodes=null;this.actionBarSnapshot.length>0;)this.revertActionBar();this.activeUnit.off("animationComplete",this,r),this.currentMap.off("tileClick",this,this.onTileSelected),t.enableInput()})},s.prototype.revertActionBar=function(){n.removeAllActions(),n.addActions(this.actionBarSnapshot.pop())},s}),define("Game/src/movementManager",["renderer","Game/src/scheduler","Game/src/pathManager","Game/src/turnManager","Renderer/src/ui/actionBarView","Renderer/src/ui/activeUnitView","Game/src/inputHandler","Game/src/utility"],function(e,t,i,n,r,s,a,o){"use strict";function c(e,t){this.actionBarSnapshot=[],this.currentMap=e,this.activeUnitView=t}return c.prototype.onMoveAction=function(){this.actionBarSnapshot.push(r.actionsList.slice(0)),r.removeAllActions(),r.addActions([{id:"cancel",method:this.onMoveActionCancelled,context:this}]),this.availableMoveTiles=i.calculateAvailableTiles(this.currentMap,{x:n.activeUnit.tileX,y:n.activeUnit.tileY,maxDistance:n.activeUnit.ap,maxClimbableHeight:n.activeUnit.maxMoveableHeight}),e.clearRenderablePaths(),e.addRenderablePath("moveTiles",this.availableMoveTiles,!1),this.currentMap.on("tileClick",this,this.onTileSelected)},c.prototype.onMoveActionCancelled=function(){this.currentMap.off("tileClick",this,this.onTileSelected),e.clearRenderablePaths(),this.selectedPath=null,this.activeUnitView.previewAP(0),this.availableMoveTiles=null,this.selectedTileCost=null,this.revertActionBar()},c.prototype.onTileSelected=function(t,s,a){if(null==t.unit){if(!o.getElementByProperty(this.availableMoveTiles,"tile",t)&&null!=this.selectedPath)return this.selectedPath=null,this.activeUnitView.previewAP(0),r.removeActionById("Move"),void 0;this.selectedPath=i.calculatePathFromNodes(this.availableMoveTiles,n.activeUnit.tileX,n.activeUnit.tileY,s,a),this.selectedPath&&(r.addActions([{id:"confirmMove",method:this.onMoveConfirmed,context:this}]),this.selectedTileCost=this.selectedPath[this.selectedPath.length-1].distance,this.activeUnitView.previewAP(this.selectedTileCost),e.addRenderablePath("selectedPath",this.selectedPath,!0)),this.selectedTile=t}},c.prototype.onMoveConfirmed=function(){a.disableInput();var i=n.activeUnit;i.setState("run");var r=this.currentMap.getTile(i.tileX,i.tileY);r.unit=null;var s=i.ap,o=s-this.selectedTileCost,c=0,l=this.selectedTileCost/35,h=this.selectedPath.slice();h.unshift({x:i.tileX,y:i.tileY});for(var u=0,d=1;d<h.length;d++){var p=h[d];p.startPercentage=u,p.endPercentage=p.distance/this.selectedTileCost,p.percentageShare=p.endPercentage-p.startPercentage,u=p.endPercentage}var f=h.shift(),m=h.shift();for(t.schedule({context:this,endTime:l,method:function(e,t){c+=t;for(var n=c/l;n>m.endPercentage;)f=m,m=h.shift();var r=m.x-f.x,a=m.y-f.y;i.setDirection(r,a);var u=(n-m.startPercentage)/m.percentageShare;i.tileX=f.x+r*u,i.tileY=f.y+a*u,i.ap=s+(o-s)*n,this.activeUnitView.setAP(i.ap,i.maxAP)},completedMethod:function(){i.tileX=m.x,i.tileY=m.y,m.tile.unit=i,i.ap=o,i.setState("idle"),this.activeUnitView.setAP(i.ap,i.maxAP),a.enableInput(),this.currentMap.off("tileClick",this,this.onTileSelected)}}),this.availableMoveTiles=null,this.selectedPath=null,this.activeUnitView.previewAP(0),this.selectedTileCost=null,e.clearRenderablePaths();this.actionBarSnapshot.length>0;)this.revertActionBar()},c.prototype.revertActionBar=function(){r.removeAllActions(),r.addActions(this.actionBarSnapshot.pop())},c}),define("Game/src/plotManager",["renderer","Game/src/scheduler","Game/src/inputHandler","Game/src/levelLoader","Game/src/turnManager","Renderer/src/ui/actionBarView","Renderer/src/ui/activeUnitView","Game/src/attackManager","Game/src/movementManager"],function(e,t,i,n,r,s,a,o,c){"use strict";function l(){}return l.prototype.initialize=function(e){this.weaponData=e,n.loadLevel("level1",e,function(e,t){this.currentMap=e,this.player=t,this.currentMap.on("tileClick",this,this.onTileSelected),this.activeUnitView=new a,this.attackManager=new o(this.currentMap,this.activeUnitView),this.movementManager=new c(this.currentMap,this.activeUnitView),r.on("beginTurn",this.activeUnitView,this.activeUnitView.onBeginTurn),r.on("endTurn",this.activeUnitView,this.activeUnitView.onEndTurn),r.on("beginTurn",this.attackManager,this.attackManager.onBeginTurn),r.on("beginTurn",this,this.onBeginTurn),r.on("endTurn",this,this.onEndTurn),r.beginTurn()}.bind(this))},l.prototype.onBeginTurn=function(t){e.camera.moveToUnit(t,this,this.onCameraMoved)},l.prototype.onCameraMoved=function(e){var t="archer"===e.type?"rangeAttack":"attack";s.addActions([{id:"move",method:this.movementManager.onMoveAction,context:this.movementManager},{id:t,method:this.attackManager.onAttackAction,context:this.attackManager},{id:"endTurn",method:this.onEndTurnAction,context:this}]),e.player.name===this.player.name&&s.showActions(),i.enableInput()},l.prototype.onEndTurn=function(){i.disableInput(),s.hideActions(),e.clearRenderablePaths(),r.beginTurn()},l.prototype.onTileSelected=function(t){this.selectedTile=t,this.activeUnitView.previewAP(0),e.clearRenderablePathById("selectedPath"),t.content&&(!t.content.isClimbable||!r.activeUnit.canClimbObjects)},l.prototype.onEndTurnAction=function(){r.endTurn()},new l}),define("Game/src/commandManager",["renderer","Game/src/levelLoader","Game/src/turnManager","Game/src/pathManager","Renderer/src/ui/renderableTurnQueue"],function(e,t,i,n,r,s){"use strict";function a(){}return a.addUnitToQueue=function(e,t){s.addUnit(e,t)},a.moveViewport=function(t,i,n){e.camera.moveViewport(t,i,n)},a.endTurn=function(){i.endTurn()},a.getAvailableTiles=function(){n.calculateAvailableTiles(t.map,i.activeUnit)},a.setActiveUnitAP=function(e){i.activeUnit.ap=e},a.setAnimation=function(e){i.activeUnit.setState(e)},a.setDirection=function(e,t){i.activeUnit.setDirection(e,t)},window.CommandManager=a,a}),require(["Game/src/scheduler","renderer","Game/src/plotManager","Game/src/commandManager","jsonLoader"],function(e,t,i,n,r){"use strict";function s(){t.initialize(document.getElementById("canvas")),e.start(),r("weapons",function(e){i.initialize(e)})}"complete"===document.readyState?s():window.addEventListener("load",s,!1)}),define("main",function(){});